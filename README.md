
# LPFolderProcessor - LPフォルダ自動生成および設定更新システム

## 【概要】

本システムは、広告案件に関連するLP（Landing Page）フォルダ構築の工数を削減し、設定ミスをゼロに近づけるための **完全自動処理ツール** でございます。

あらかじめ構成されたテンプレートディレクトリと、CSV形式で準備された案件データをもとに、以下の処理を一括で実施いたします：

・テンプレート配下の `_df` ディレクトリを案件名でコピー  
・案件用 `config.php` を生成または編集  
・adjust計測の3要素（`$client_id` / `$adjust` / `$adjust_url`）をCSVから反映  
・ログファイルを 年/月/日 形式で自動出力  
・CSVファイルを処理完了後に自動削除  

**適用範囲例**：大手クライアント案件、複数ドメイン同時展開、社内レビュー用LP生成など

---

## 【構成】

本プロジェクトは以下のような構成を前提としております：

・`LPFolderProcessor.py`：メイン処理スクリプト  
・`config.json`：設定ファイル（初回起動時に自動生成）  
・`更新するデータCSV/`：案件CSVを格納する専用フォルダ  
・`log/`：年/月単位で出力されるログフォルダ  
・`run.bat`：エンベッダブルPython用の起動スクリプト  
・`PythonRun/python.exe`：Python埋め込み実行環境（バッチで起動）

---

## 【実行方法】

### 1．CSV準備

`更新するデータCSV` フォルダ内に、以下形式のCSVファイルを配置してください：

```csv
LPフォルダ名,案件名フォルダ名,クライアントID,adjustフラグ,adjustURL
alice,alice_test,10101010,1,https://adj.st/example
buzz,buzz_test,20202020,0,


2．実行手順
run.bat をダブルクリックで起動してください。

3．処理内容
・指定テンプレートLPフォルダ（例：alice）配下に、案件フォルダ（例：alice_test）を自動生成
・その中に _df の内容をコピーし、config.php を生成または更新
・adjust設定（client_id / フラグ / URL）をCSVから反映
・ログファイルを log/YYYY年MM月/yyyyMMdd.log に出力
・CSVファイルは完了後に自動削除

【CSVの仕様と要件】
CSVファイルは以下の形式を満たす必要がございます：

・列数は5列（カンマ区切り）
・1列目：LPフォルダ名（テンプレートフォルダ名）
・2列目：案件名フォルダ名（コピー先）
・3列目：client_id（数値8桁）
・4列目：adjustフラグ（0または1）
・5列目：adjustURL（adjust=1のときは必須）

要件を満たさない行はスキップされ、ログに警告が記録されます。

【ログ出力について】
・出力先：log/YYYY年MM月/yyyyMMdd.log
・ログ形式：
　[時刻] [レベル] (ファイル名:行番号) メッセージ

記録されるログ内容には以下が含まれます：

・LPフォルダ作成（新規 or 既存）
・_df コピーの成否
・config.php の新規作成 or 編集成功
・adjust未設定時の警告
・エラー発生時の詳細内容（スタックトレースを含む）

【エラー処理】
以下のようなエラーにも対応可能です：

・文字コードエラー（utf-8 / shift_jis / cp932 / euc-jp に順次フォールバック）
・adjust=1 かつ URL未入力 → 警告ログ出力
・テンプレート内に _df が存在しない → スキップ対象として記録
・config.php に編集不可境界線が存在しない → 下部を残したまま更新処理を実施

すべての例外は try-catch 構文で捕捉され、詳細がログに出力されます。

【拡張方針（将来的対応案）】
1．CSVに「ドメイン設定」「広告主ID」等の列を追加し、config.php に自動反映
2．同名案件が既に存在する場合の「上書き確認モード（Y/N）」導入
3．案件フォルダ内に .done ファイルを生成し、再処理防止ロジックを追加
4．config.php 内のマッピング定義を外部JSONに抽出し、動的編集対応
5．GUI操作（ドラッグ＆ドロップ）によるCSV投入・進捗可視化（tkinter統合が前提）

【注意事項と制限】
・テンプレートフォルダ：
　\\rin\rep\営業本部\プロジェクト\fam\デザイン関係\lp\top55_template へのアクセス権が必要です

・_df フォルダがテンプレートに含まれていない場合、自動生成されるが内容は空であり、config.php も簡易版になります

・config.php 内のコメント これより下は編集不可 の削除は絶対に禁止です

・動作環境：Windows + Python埋め込み環境（Python 3.13 など）に限定されます

・1CSVに100件を超える行が含まれていても、約10秒以内に処理完了が可能ですが、同時アクセスやネットワーク負荷にご注意ください

【起動環境】
・起動方法：run.bat をダブルクリック（内部で PythonRun/python.exe を起動）
・対応OS：Windows 10 以上
・Python環境：Python埋め込み（エンベッダブル）を前提とし、必要なDLLおよびモジュールが内包されていること

【開発者メモ】
・本ツールはエンジニアリングチームによって一括管理されることを想定しております
・テンプレート構成、CSV形式、ログ仕様などを変更したい場合は LPFolderProcessor.py を編集してください
・設定変更（テンプレートパス、ログ出力パス等）は config.json にて動的に切替可能です
